<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Combined News Sentiment Dashboards</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .tab-btn { @apply px-3 py-2 rounded-lg border bg-white text-slate-700; }
    .tab-btn.active { @apply bg-slate-900 text-white; }
    .hint { @apply text-xs text-slate-500; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="max-w-7xl mx-auto p-6">
    <header class="mb-4">
      <h1 class="text-3xl font-bold">Combined News Sentiment Dashboards</h1>
      <p class="hint mt-1">
        Tabs embed your existing pages. You can override the base URL below (use your GitHub Pages URL).
      </p>
    </header>

    <!-- Base URL control -->
    <section class="mb-4 p-4 bg-white border rounded-xl">
      <div class="flex flex-col md:flex-row gap-3 items-start md:items-end">
        <div class="grow w-full">
          <label class="block text-sm font-medium mb-1" for="baseUrl">Base URL</label>
          <input id="baseUrl" type="url" placeholder="https://jonas-sickler.github.io/news-sentiment-dashboard/"
                 class="w-full border rounded-lg p-2"
                 />
          <p id="usingBase" class="hint mt-1"></p>
        </div>
        <div class="flex items-end gap-2">
          <button id="applyBase" class="px-3 py-2 rounded-lg bg-slate-900 text-white">Apply</button>
          <button id="resetBase" class="px-3 py-2 rounded-lg border">Reset</button>
        </div>
      </div>
    </section>

    <!-- Tabs -->
    <section class="mb-3">
      <div class="flex gap-2 flex-wrap">
        <button class="tab-btn active" data-tab="brands">Brands</button>
        <button class="tab-btn" data-tab="ceos">CEOs</button>
        <button class="tab-btn" data-tab="sectors">Sectors</button>
        <span id="openExternalWrap" class="ml-auto">
          <a id="openExternal" target="_blank" rel="noopener"
             class="underline text-sm text-slate-600">Open current tab in a new tab</a>
        </span>
      </div>
    </section>

    <!-- Frame wrapper -->
    <section class="bg-white border rounded-xl overflow-hidden">
      <div class="flex items-center justify-between p-3 border-b">
        <div class="hint">
          <span id="frameStatus">Loading…</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="tallerBtn" class="px-2 py-1 border rounded">Taller</button>
          <button id="shorterBtn" class="px-2 py-1 border rounded">Shorter</button>
        </div>
      </div>
      <iframe id="dashFrame"
              src="about:blank"
              style="width:100%; height:1200px; border:0;"
              referrerpolicy="no-referrer-when-downgrade"
              loading="eager"></iframe>
    </section>

    <p class="hint mt-2">
      Tip: If the frame is on the same origin (e.g., this file is served from your GitHub Pages site),
      the height will auto-adjust to fit the page content. Otherwise, use the “Taller/Shorter” buttons or open
      the view in a new tab.
    </p>
  </div>

<script>
(() => {
  // ---- Defaults (change if your file names differ) ----
  const DEFAULT_PAGES = {
    brands : 'dashboard.html',
    ceos   : 'ceo-dashboard.html',
    sectors: 'sectors.html'
  };

  // Parse URL params for base override, or read localStorage
  const urlParams  = new URLSearchParams(location.search);
  const savedBase  = localStorage.getItem('combined_base_url') || '';
  const initialBase = urlParams.get('base') || savedBase || '';

  // If you changed filenames, you can also optionally pass ?brands=..., ?ceos=..., ?sectors=...
  const pages = {
    brands : urlParams.get('brands')  || DEFAULT_PAGES.brands,
    ceos   : urlParams.get('ceos')    || DEFAULT_PAGES.ceos,
    sectors: urlParams.get('sectors') || DEFAULT_PAGES.sectors
  };

  // Pass through other query params to the embedded pages (e.g., ?date=2025-08-16&debug=1)
  function passthroughSearch() {
    const keep = new URLSearchParams(location.search);
    ['base','brands','ceos','sectors'].forEach(k => keep.delete(k));
    const s = keep.toString();
    return s ? ('?'+s) : '';
  }

  // Elements
  const frame       = document.getElementById('dashFrame');
  const frameStatus = document.getElementById('frameStatus');
  const baseInput   = document.getElementById('baseUrl');
  const usingBase   = document.getElementById('usingBase');
  const applyBase   = document.getElementById('applyBase');
  const resetBase   = document.getElementById('resetBase');
  const openExternal = document.getElementById('openExternal');
  const tallerBtn   = document.getElementById('tallerBtn');
  const shorterBtn  = document.getElementById('shorterBtn');

  const tabBtns = [...document.querySelectorAll('.tab-btn')];

  let currentTab = localStorage.getItem('combined_active_tab') || 'brands';
  let baseUrl = initialBase;

  // UI init
  baseInput.value = baseUrl;
  reflectBaseUsed();

  function reflectBaseUsed(){
    usingBase.textContent = baseUrl
      ? `Using: ${baseUrl}`
      : 'Using relative paths (this file’s location)';
  }

  function resolveSrc(pagePath){
    const path = (baseUrl ? baseUrl.replace(/\/+$/,'') + '/' : '') + pagePath.replace(/^\/+/,'');
    return path + passthroughSearch();
  }

  function setActiveTab(tab){
    currentTab = tab;
    localStorage.setItem('combined_active_tab', tab);
    tabBtns.forEach(b=>{
      b.classList.toggle('active', b.getAttribute('data-tab') === tab);
    });
    const page = pages[tab];
    const src = resolveSrc(page);
    frameStatus.textContent = 'Loading…';
    frame.src = src;
    openExternal.href = src;
  }

  // Handle base changes
  applyBase.addEventListener('click', ()=>{
    baseUrl = (baseInput.value || '').trim();
    localStorage.setItem('combined_base_url', baseUrl);
    reflectBaseUsed();
    setActiveTab(currentTab); // reload
  });
  resetBase.addEventListener('click', ()=>{
    baseUrl = '';
    baseInput.value = '';
    localStorage.removeItem('combined_base_url');
    reflectBaseUsed();
    setActiveTab(currentTab);
  });

  // Tab clicks
  tabBtns.forEach(btn=>{
    btn.addEventListener('click', ()=> setActiveTab(btn.getAttribute('data-tab')));
  });

  // Manual height controls
  tallerBtn.addEventListener('click', ()=>{
    const h = parseInt(frame.style.height||'1200',10);
    frame.style.height = (h+300) + 'px';
  });
  shorterBtn.addEventListener('click', ()=>{
    const h = parseInt(frame.style.height||'1200',10);
    frame.style.height = Math.max(600, h-300) + 'px';
  });

  // Try auto-resize if same-origin
  let resizeTimer = null;
  function tryAutoResize(){
    // If cross-origin, accessing contentDocument will throw; guard with try/catch
    try{
      const doc = frame.contentDocument;
      if(!doc || !doc.body) return;
      const desired = Math.max(900, doc.documentElement.scrollHeight, doc.body.scrollHeight);
      frame.style.height = desired + 'px';
      frameStatus.textContent = 'Loaded';
    }catch(_e){
      // cross-origin, leave status but don't error
      frameStatus.textContent = 'Loaded (use Taller/Shorter if needed)';
    }
  }
  frame.addEventListener('load', ()=>{
    frameStatus.textContent = 'Loaded';
    clearInterval(resizeTimer);
    // Poll a few times after load to catch charts rendering
    let count = 0;
    resizeTimer = setInterval(()=>{
      tryAutoResize();
      if(++count >= 10) clearInterval(resizeTimer);
    }, 500);
  });

  // Boot
  setActiveTab(currentTab);
})();
</script>
</body>
</html>
